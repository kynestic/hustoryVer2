<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/assets/css/style.css">
    <script src="https://kit.fontawesome.com/4a24fc7d8b.js" crossorigin="anonymous"></script>
    <title>Đọc truyện online, đọc truyện hay</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>
<body style="background-color: var(--lightmode_background);">
    <div id="wrap">
        <div id="nav">
            <div class="container">
                <div class="logo"><a style="text-decoration: none; color: white;"  href="../home">HuStory</a></div>
                <div class="controller">
                    <div class="category nav-button-wrapper">
                        <div class="nav-button">
                            <i class="fa-solid fa-list"></i>
                            Thể loại
                            <i class="fa-solid fa-caret-down"></i>
                        </div>
                        <div class="category-list nav-list">
                            <div class="">
                                <ul class="dropdown-list">
                                    <li><a href="../../search/category/4">Tiên Hiệp</a></li>
                                    <li><a href="../../search/category/5">Kiếm hiệp</a></li>
                                    <li><a href="../../search/category/7">Xuyên Không</a></li>
                                </ul>
                            </div>

                            <div class="">
                                <ul class="dropdown-list">
                                    <li><a href="../../search/category/8">Linh Dị</a></li>
                                    <li><a href="../../search/category/9">Trinh Thám</a></li>
                                    <li><a href="../../search/category/3">Đô Thị</a></li>
                                </ul>
                            </div>

                            <div class="">
                                <ul class="dropdown-list">
                                    <li><a href="../../search/category/1">Huyền Huyễn</a></li>
                                    <li><a href="../../search/category/2">Khoa Huyễn</a></li>
                                    <li><a href="../../search/category/6">Dị Giới</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="length nav-button-wrapper">
                        <div class="nav-button">
                            <i class="fa-solid fa-list"></i>
                            Độ dài
                            <i class="fa-solid fa-caret-down"></i>
                        </div>
                        <ul class="length-list nav-list dropdown-list">
                            <li><a href="./list.html">Dưới 100 chương</a></li>
                            <li><a href="./list.html">100-500 chương</a></li>
                            <li><a href="./list.html">500-1000 chương</a></li>
                            <li><a href="./list.html">Trên 1000 chương</a></li>
                        </ul>
                    </div>

                    <div class="setting nav-button-wrapper">
                        <div class="nav-button">
                            <i class="fa-solid fa-list"></i>
                            Cài đặt
                            <i class="fa-solid fa-caret-down"></i>
                        </div>

                        <ul class="setting-list nav-list dropdown-list">
                            <li>
                                <a>
                                    <label for="dark-mode">
                                        <i class="fa-solid fa-moon"></i>
                                        Darkmode
                                    </label>
                                    <input type="radio" name="theme" id="dark-mode">
                                </a>
                            </li>
                            <li>
                                <a>
                                    <label for="light-mode">
                                        <i class="fa-solid fa-sun"></i>
                                        Lightmode
                                    </label>
                                    <input type="radio" name="theme" id="light-mode">
                                </a>
                            </li>
                        </ul>
                    </div>

                    <div class="search-box nav-button-wrapper">
                        <div class="search-input">
                            <input id ="searchInput" type="text" placeholder="Tìm truyện...">
                        </div>
                        <div class="search-button">
                            <a id="searchButton"><i class="fa-solid fa-magnifying-glass"></i></a>
                        </div>
                    </div>

                    <div class="user-box nav-button-wrapper">
                        <div class="nav-button">Đăng ký</div>
                        <div class="nav-button">Đăng nhập</div>
                    </div>
                </div>
            </div>
            
        </div>
        <div class="container" id="popular-recently">
            <div class="header">
                <div class="header-title">Truyện Hot <i class="fa-solid fa-fire-flame-curved"></i></div>
                <div class="select-category-wrapper">
                    <select class="select-category" id = "popular-select">
                        <option value="Tất cả">Tất cả</option>
                        <option value="Tiên hiệp">Tiên hiệp</option>
                        <option value="Kiếm hiệp">Kiếm hiệp</option>
                        <option value="Ngôn tình">Ngôn tình</option>
                    </select>
                </div>
            </div>
            <div class="popular-content row-wrapper">
                <div class="row">
                    <a class="popular-item item-no-1" id ="popular-item-item-no-1" href="">
                        <img src="" alt="">
                        <div class="popular-item-title"><h3></h3></div>
                    </a>
    
                    <a class="popular-item item-no-2" id ="popular-item-item-no-2" href="">
                        <img src="" alt="">
                        <div class="popular-item-title"><h3></h3></div>
                    </a>
    
                    <a class="popular-item item-no-3" id ="popular-item-item-no-3" href="">
                        <img src="" alt="">
                        <div class="popular-item-title"><h3></h3></div>
                    </a>
    
                    <a class="popular-item item-no-4" id ="popular-item-item-no-4" href="">
                        <img src="" alt="">
                        <div class="popular-item-title"><h3></h3></div>
                    </a>
    
                    <a class="popular-item item-no-5" id ="popular-item-item-no-5" href="">
                        <img src="" alt="">
                        <div class="popular-item-title"><h3></h3></div>
                    </a>
    
                    <a class="popular-item item-no-6" id ="popular-item-item-no-6" href="">
                        <img src="" alt="">
                        <div class="popular-item-title"><h3></h3></div>
                    </a>
    
                    <a class="popular-item item-no-7" id ="popular-item-item-no-7" href="">
                        <img src="" alt="">
                        <div class="popular-item-title"><h3></h3></div>
                    </a>
    
                    <a class="popular-item item-no-8" id ="popular-item-item-no-8" href="">
                        <img src="" alt="">
                        <div class="popular-item-title"><h3></h3></div>
                    </a>
                </div>

                <div class="row">
                    <a class="popular-item item-no-1" id ="popular-item-item-no-9" href="">
                        <img src="" alt="">
                        <div class="popular-item-title"><h3></h3></div>
                    </a>
    
                    <a class="popular-item item-no-2" id ="popular-item-item-no-10" href="">
                        <img src="" alt="">
                        <div class="popular-item-title"><h3></h3></div>
                    </a>
    
                    <a class="popular-item item-no-3" id ="popular-item-item-no-11" href="">
                        <img src="" alt="">
                        <div class="popular-item-title"><h3></h3></div>
                    </a>
    
                    <a class="popular-item item-no-4" id ="popular-item-item-no-12" href="">
                        <img src="" alt="">
                        <div class="popular-item-title"><h3></h3></div>
                    </a>
    
                    <a class="popular-item item-no-5" id ="popular-item-item-no-13" href="">
                        <img src="" alt="">
                        <div class="popular-item-title"><h3></h3></div>
                    </a>
    
                    <a class="popular-item item-no-6" id ="popular-item-item-no-14" href="">
                        <img src="" alt="">
                        <div class="popular-item-title"><h3></h3></div>
                    </a>
    
                    <a class="popular-item item-no-7" id ="popular-item-item-no-15" href="">
                        <img src="" alt="">
                        <div class="popular-item-title"><h3></h3></div>
                    </a>
    
                    <a class="popular-item item-no-8" id ="popular-item-item-no-16" href="">
                        <img src="" alt="">
                        <div class="popular-item-title"><h3></h3></div>
                    </a>
                </div>
            </div>
        </div>
        <div class="container" id="upload-recently">
            <div class="upload-recently-wrapper">
                <div class="header">
                    <div class="header-title">
                        Truyện mới cập nhật
                        <i class="fa-solid fa-angle-right"></i>
                    </div>
    
                    <div class="select-category-wrapper">
                        <select class="select-category" id = "popular-select">
                            <option value="Tất cả">Tất cả</option>
                            <option value="Tiên hiệp">Tiên hiệp</option>
                            <option value="Kiếm hiệp">Kiếm hiệp</option>
                            <option value="Ngôn tình">Ngôn tình</option>
                        </select>
                    </div>
                </div>

                <div class="upload-content">
                    <div class="upload-item" id="upload-item-no-1">
                        <div class="upload-title">
                            <a href=""></a>    
                        </div>
                        <div class="upload-category">
                        </div>
                        <div class="upload-chapter">
                            <a href=""></a>
                        </div>
                        <div class="upload-time">
                        </div>
                    </div>

                    <div class="upload-item" id="upload-item-no-2">
                        <div class="upload-title">
                            <a href=""></a>    
                        </div>
                        <div class="upload-category">
                        </div>
                        <div class="upload-chapter">
                            <a href=""></a>
                        </div>
                        <div class="upload-time">
                        </div>
                    </div>

                    <div class="upload-item" id="upload-item-no-3">
                        <div class="upload-title">
                            <a href=""></a>    
                        </div>
                        <div class="upload-category">
                        </div>
                        <div class="upload-chapter">
                            <a href=""></a>
                        </div>
                        <div class="upload-time">
                        </div>
                    </div>

                    <div class="upload-item" id="upload-item-no-4">
                        <div class="upload-title">
                            <a href=""></a>    
                        </div>
                        <div class="upload-category">
                        </div>
                        <div class="upload-chapter">
                            <a href=""></a>
                        </div>
                        <div class="upload-time">
                        </div>
                    </div>

                    <div class="upload-item" id="upload-item-no-5">
                        <div class="upload-title">
                            <a href=""></a>    
                        </div>
                        <div class="upload-category">
                        </div>
                        <div class="upload-chapter">
                            <a href=""></a>
                        </div>
                        <div class="upload-time">
                        </div>
                    </div>

                    <div class="upload-item" id="upload-item-no-6">
                        <div class="upload-title">
                            <a href=""></a>    
                        </div>
                        <div class="upload-category">
                        </div>
                        <div class="upload-chapter">
                            <a href=""></a>
                        </div>
                        <div class="upload-time">
                        </div>
                    </div>

                    <div class="upload-item" id="upload-item-no-7">
                        <div class="upload-title">
                            <a href=""></a>    
                        </div>
                        <div class="upload-category">
                        </div>
                        <div class="upload-chapter">
                            <a href=""></a>
                        </div>
                        <div class="upload-time">
                        </div>
                    </div>

                    <div class="upload-item" id="upload-item-no-8">
                        <div class="upload-title">
                            <a href=""></a>    
                        </div>
                        <div class="upload-category">
                        </div>
                        <div class="upload-chapter">
                            <a href=""></a>
                        </div>
                        <div class="upload-time">
                        </div>
                    </div>

                    <div class="upload-item" id="upload-item-no-9">
                        <div class="upload-title">
                            <a href=""></a>    
                        </div>
                        <div class="upload-category">
                        </div>
                        <div class="upload-chapter">
                            <a href=""></a>
                        </div>
                        <div class="upload-time">
                        </div>
                    </div>

                    <div class="upload-item" id="upload-item-no-10">
                        <div class="upload-title">
                            <a href=""></a>    
                        </div>
                        <div class="upload-category">
                        </div>
                        <div class="upload-chapter">
                            <a href=""></a>
                        </div>
                        <div class="upload-time">
                        </div>
                    </div>

                    <div class="upload-item" id="upload-item-no-11">
                        <div class="upload-title">
                            <a href=""></a>    
                        </div>
                        <div class="upload-category">
                        </div>
                        <div class="upload-chapter">
                            <a href=""></a>
                        </div>
                        <div class="upload-time">
                        </div>
                    </div>

                    <div class="upload-item" id="upload-item-no-12">
                        <div class="upload-title">
                            <a href=""></a>    
                        </div>
                        <div class="upload-category">
                        </div>
                        <div class="upload-chapter">
                            <a href=""></a>
                        </div>
                        <div class="upload-time">
                        </div>
                    </div>

                    <div class="upload-item" id="upload-item-no-13">
                        <div class="upload-title">
                            <a href=""></a>    
                        </div>
                        <div class="upload-category">
                        </div>
                        <div class="upload-chapter">
                            <a href=""></a>
                        </div>
                        <div class="upload-time">
                        </div>
                    </div>

                    <div class="upload-item" id="upload-item-no-14">
                        <div class="upload-title">
                            <a href=""></a>    
                        </div>
                        <div class="upload-category">
                        </div>
                        <div class="upload-chapter">
                            <a href=""></a>
                        </div>
                        <div class="upload-time">
                        </div>
                    </div>

                    <div class="upload-item" id="upload-item-no-15">
                        <div class="upload-title">
                            <a href=""></a>    
                        </div>
                        <div class="upload-category">
                        </div>
                        <div class="upload-chapter">
                            <a href=""></a>
                        </div>
                        <div class="upload-time">
                        </div>
                    </div>

                    <div class="upload-item" id="upload-item-no-16">
                        <div class="upload-title">
                            <a href=""></a>    
                        </div>
                        <div class="upload-category">
                        </div>
                        <div class="upload-chapter">
                            <a href=""></a>
                        </div>
                        <div class="upload-time">
                        </div>
                    </div>
                </div>
            </div>

            <div class="navigation">
                <div class="navigation-reading-recently ">
                    <div class="header">
                        <div class="header-title">Đọc gần đây</div>
                    </div> 
                    <div class="reading-recently-wrapper">
                        <div class="reading-recently-item">
                            <div class="reading-recently-title">
                                <i class="fa-solid fa-angle-right"></i>
                                <a href="">Đế Bá</a>
                            </div>
                            <div class="reading-recently-chapter">
                                <a href="">
                                    Đọc tiếp C1976
                                </a>
                            </div>
                        </div>

                        <div class="reading-recently-item">
                            <div class="reading-recently-title">
                                <i class="fa-solid fa-angle-right"></i>
                                <a href="">Đế Bá</a>
                            </div>
                            <div class="reading-recently-chapter">
                                <a href="">
                                    Đọc tiếp C1976
                                </a>
                            </div>
                        </div>

                        <div class="reading-recently-item">
                            <div class="reading-recently-title">
                                <i class="fa-solid fa-angle-right"></i>
                                <a href="">Đế Bá</a>
                            </div>
                            <div class="reading-recently-chapter">
                                <a href="">
                                    Đọc tiếp C1976
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="navigation-category">
                    <div class="header">
                        <div class="header-title">Thể loại</div>
                    </div> 
                    <div class="navigation-category-wrapper">
                        <ul>
                            <li><a href="./list.html">Tiên Hiệp</a></li>
                            <li><a href="./list.html">Kiếm hiệp</a></li>
                            <li><a href="./list.html">Huyền Huyễn</a></li>
                        </ul>

                        <ul>
                            <li><a href="../search/categories/">Dị Giới</a></li>
                            <li><a href="./list.html">Linh Dị</a></li>
                            <li><a href="./list.html">Trinh Thám</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container" id="story-completed">
            <div class="header">
                <div class="header-title">Truyện đã hoàn thành</div>
            </div>
            <div class="completed-wrapper row-wrapper">
                <div class="row">
                    <a class="completed-item item-no-1" id="completed-item-item-no-1" href="./story.html">
                        <img src="" alt="">
                        <div class="completed-item-title"><h3></h3></div>
                        <div class="completed-item-chapter"><div></div></div>
                    </a>
    
                    <a class="completed-item item-no-2" id="completed-item-item-no-2" href="./story.html">
                        <img src="" alt="">
                        <div class="completed-item-title"><h3></h3></div>
                        <div class="completed-item-chapter"><div></div></div>
                    </a>
    
                    <a class="completed-item item-no-3" id="completed-item-item-no-3" href="./story.html">
                        <img src="" alt="">
                        <div class="completed-item-title"><h3></h3></div>
                        <div class="completed-item-chapter"><div></div></div>
                    </a>
    
                    <a class="completed-item item-no-4" id="completed-item-item-no-4" href="./story.html">
                        <img src="" alt="">
                        <div class="completed-item-title"><h3></h3></div>
                        <div class="completed-item-chapter"><div></div></div>
                    </a>
    
                    <a class="completed-item item-no-5" id="completed-item-item-no-5" href="./story.html">
                        <img src="" alt="">
                        <div class="completed-item-title"><h3></h3></div>
                        <div class="completed-item-chapter"><div></div></div>
                    </a>

                    <a class="completed-item item-no-6" id="completed-item-item-no-6" href="./story.html">
                        <img src="" alt="">
                        <div class="completed-item-title"><h3></h3></div>
                        <div class="completed-item-chapter"><div></div></div>
                    </a>
    
                </div>

                
            </div>
        </div>
    </div>
    <div id="footer"></div>

    <script>
        const searchInput = document.getElementById('searchInput');
        const searchButton = document.getElementById('searchButton');
        
        searchButton.onclick = function(){
            let searchValue = searchInput.value;
            searchValue = searchValue.replace(/ +(?= )/g,'');
            window.location.href = '../' + 'search/' + searchValue;
        }



        fetch('/popular')
            .then(response => response.json())
            .then(chapters=>{
                for (let i = 1; i <= 16 && chapters[i - 1]; i++) {
                    let tmp = document.getElementById('popular-item-item-no-' + i);
                    tmp.href = '../' + 'story/' + chapters[i - 1].storyId;
                    tmp = tmp.firstElementChild;
                    tmp.src = chapters[i - 1].storyImg;
                    tmp = tmp.nextElementSibling;
                    tmp.firstElementChild.innerHTML = chapters[i - 1].storyName;
                };
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);
            })

        fetch('/getLatest')
            .then(response => response.json()) // Đọc phản hồi dưới dạng JSON
            .then(chapters => {
                for (let i = 1; i <= 15; i++){
                    let ele = document.querySelector('#upload-item-no-' + i + ' .upload-title');
                    ele.firstElementChild.href = '../' + 'story/' + chapters[i - 1].storyId;
                    ele.firstElementChild.innerText = chapters[i - 1].storyName;

                    // ele = document.querySelector('#upload-item-no-' + i + ' .upload-time');
                    // date2 = Date.now;
                    // date1 = chapters[i - 1].publishTime.replace( /[-]/g, '/' );
                    
                    // let Difference_In_Days = Math.floor((date2 - date1)/ (1000 * 60 * 60 * 24));
                    // ele.innerText = Difference_In_Days;

                    ele = document.querySelector('#upload-item-no-' + i + ' .upload-chapter');
                    ele.firstElementChild.innerText = 'Chương ' + chapters[i - 1].chapterNumber;
                    ele.firstElementChild.href = '../' + 'story/' + chapters[i - 1].storyId + '/chapter/' + chapters[i - 1].chapterId;

                    ele = document.querySelector('#upload-item-no-' + i + ' .upload-category');
                    fetch('/story/getCategory/' + chapters[i - 1].storyId)
                        .then(response => response.json())
                        .then(list => {
                            const listItem = Object.values(list.categories);
                            // Xóa hết các phần tử con trong wrapper
                            //wrapper.innerHTML = '';
                        
                            // Duyệt qua mảng listItem để tạo các phần tử <a>
                                for (let i = 0; i < 2 && listItem[i]; i++) {
                                    // Tạo phần tử <a>
                                    console.log(listItem);
                                    let tmp = document.createElement('a');
                                    tmp.innerHTML = listItem[i];
                                    
                                    // Nếu là phần tử đầu tiên, không thêm dấu phẩy
                                    if (i === 0) {
                                        ele.appendChild(tmp);
                                    } else {
                                        // Thêm dấu phẩy và khoảng trắng trước mỗi phần tử từ thứ hai trở đi
                                        ele.appendChild(document.createTextNode(', '));
                                        ele.appendChild(tmp);
                                    }
                                }
                        })
                        .catch(error => {
                            console.error('There was a problem with the fetch operation:', error);
                        });
                    
                    
                }
            })
            .catch(error => console.error('Error:', error));

            fetch('/getComplete')
            .then(response => response.json())
            .then(chapters=>{
                for (let i = 1; i <= 6 && chapters[i - 1]; i++) {
                    let tmp = document.getElementById('completed-item-item-no-' + i);
                    tmp.href = '../' + 'story/' + chapters[i - 1].storyId;
                    tmp = tmp.firstElementChild;
                    tmp.src = chapters[i - 1].storyImg;
                    tmp = tmp.nextElementSibling;
                    tmp.firstElementChild.innerText = chapters[i - 1].storyName;
                    tmp = tmp.nextElementSibling;
                    tmp.firstElementChild.innerHTML = chapters[i - 1].storyStatus + ' - ' + chapters[i - 1].chapterCount + ' Chương';    
                };
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);
            })

    </script>
</body>
</html>