<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/assets/css/chapter.css">
    <script src="https://kit.fontawesome.com/4a24fc7d8b.js" crossorigin="anonymous"></script>
    <title>Đọc truyện online, đọc truyện hay</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</head>
<body>
    <div id="wrap">
        <div id="nav">
            <div class="container">
                <div class="logo">HuStory</div>
                <div class="controller">
                    <div class="category nav-button-wrapper">
                        <div class="nav-button">
                            <i class="fa-solid fa-list"></i>
                            Thể loại
                            <i class="fa-solid fa-caret-down"></i>
                        </div>
                        <div class="category-list nav-list">
                            <div class="">
                                <ul class="dropdown-list">
                                    <li><a href="">Tiên Hiệp</a></li>
                                    <li><a href="">Kiếm hiệp</a></li>
                                    <li><a href="">Ngôn Tình</a></li>
                                </ul>
                            </div>

                            <div class="">
                                <ul class="dropdown-list">
                                    <li><a href="">Tiên Hiệp</a></li>
                                    <li><a href="">Kiếm hiệp</a></li>
                                    <li><a href="">Ngôn Tình</a></li>
                                </ul>
                            </div>

                            <div class="">
                                <ul class="dropdown-list">
                                    <li><a href="">Tiên Hiệp</a></li>
                                    <li><a href="">Kiếm hiệp</a></li>
                                    <li><a href="">Ngôn Tình</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="length nav-button-wrapper">
                        <div class="nav-button">
                            <i class="fa-solid fa-list"></i>
                            Độ dài
                            <i class="fa-solid fa-caret-down"></i>
                        </div>
                        <ul class="length-list nav-list dropdown-list">
                            <li><a href="">Dưới 100 chương</a></li>
                            <li><a href="">100-500 chương</a></li>
                            <li><a href="">500-1000 chương</a></li>
                            <li><a href="">Trên 1000 chương</a></li>
                        </ul>
                    </div>

                    <div class="setting nav-button-wrapper">
                        <div class="nav-button">
                            <i class="fa-solid fa-list"></i>
                            Cài đặt
                            <i class="fa-solid fa-caret-down"></i>
                        </div>

                        <ul class="setting-list nav-list dropdown-list">
                            <li>
                                <a>
                                    <label for="dark-mode">
                                        <i class="fa-solid fa-moon"></i>
                                        Darkmode
                                    </label>
                                    <input type="radio" name="theme" id="dark-mode">
                                </a>
                            </li>
                            <li>
                                <a>
                                    <label for="light-mode">
                                        <i class="fa-solid fa-sun"></i>
                                        Lightmode
                                    </label>
                                    <input type="radio" name="theme" id="light-mode">
                                </a>
                            </li>
                        </ul>
                    </div>

                    <div class="search-box nav-button-wrapper">
                        <div class="search-input">
                            <input type="text" placeholder="Tìm truyện...">
                        </div>
                        <div class="search-button">
                            <a href=""><i class="fa-solid fa-magnifying-glass"></i></a>
                        </div>
                    </div>

                    <div class="user-box nav-button-wrapper">
                        <div class="nav-button" href="">Đăng ký</div>
                        <div class="nav-button">Đăng nhập</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div id="chapter">
                <div class="chapter-header">
                    <div class="header-story-name"><a href=""></a></div>
                    <div class="header-chapter-name"><p></p></div>
                    <hr class="header-start">
                    <div class="control-bar">
                        <div class="prev chapter-btn">
                            <a href="">
                                <i class="fa-solid fa-angle-left"></i>
                                Chương trước
                            </a>
                        </div>
                        <div class="show-list-btn">
                            <a href=""><i class="fa-solid fa-list"></i></a>
                        </div>
                        <div class="next chapter-btn">
                            <a href="">
                                Chương tiếp 
                                <i class="fa-solid fa-angle-right"></i>
                            </a>
                        </div>
                    </div>
                    <hr class="header-end">
                </div>

                <div class="chapter-content" id="main-content">   
                </div>

                <div class="chapter-footer">
                    <hr class="header-end">
                    <div class="control-bar">
                        <div class="prev chapter-btn">
                            <a href="">
                                <i class="fa-solid fa-angle-left"></i>
                                Chương trước
                            </a>
                        </div>
                        <div class="show-list-btn">
                            <a href=""><i class="fa-solid fa-list"></i></a>
                        </div>
                        <div class="next chapter-btn">
                            <a href="">
                                Chương tiếp 
                                <i class="fa-solid fa-angle-right"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="footer"></div>
    </div>
    <script>
        let content = document.getElementById('main-content');
        // Lắng nghe sự kiện khi click vào một phần tử trên trang
        content.addEventListener('click', function(event) {
            // Ngăn chặn hành vi mặc định của thẻ a
            event.preventDefault();
            
            // Xác định khoảng cách cần trượt xuống (ví dụ: 500px)
            var distanceToScroll = 500;
            
            // Tính toán vị trí mới để trượt xuống
            var newY = window.scrollY + distanceToScroll;
            
            // Thực hiện cuộn trang đến vị trí mới
            window.scrollTo({
                top: newY,
                behavior: 'smooth' // Cuộn mượt
            });
        });

        const path = window.location.pathname; // Lấy đường dẫn từ URL
        const parts = path.split('/'); // Tách đường dẫn thành các phần

        const id1 = parts[2]; // Phần thứ 3 là id1 (vì phần tử đầu tiên là một chuỗi rỗng sau 'http://example.com')
        const id2 = parts[4]; // Phần thứ 5 là id2
        console.log(id1 + ' ' +id2);
        
        fetch('/story/' + id1 + '/incrementView', {
          method: 'PUT'
        })
          .then(response => response.json())
          .then(data => {
            console.log('Views updated:', data.message);
          })
          .catch(error => {
            console.error('Error:', error);
          });

        fetch('/story/' + id1 + '/chapter/' + id2 + '/getContent')
            .then(response => response.json()) // Đọc phản hồi dưới dạng JSON
            .then(chapters => {
                let storyName = document.querySelector('.chapter-header .header-story-name a');
                storyName.innerHTML = chapters[0].storyName;
                storyName.href = '/story/' + id1;
                
                let chapterName = document.querySelector('.chapter-header .header-chapter-name p');
                chapterName.innerHTML = 'Chương ' + chapters[0].chapterNumber + ': ' + chapters[0].chapterName;
        
                let ele = document.getElementById('main-content'); // Truy cập phần tử bằng ID mà không có #
                if (ele && chapters.length > 0) {
                    ele.innerHTML = chapters[0].chapterContent.replace(/\n/g, "<br>"); // Thay thế dấu xuống dòng
                } else {
                    console.error('No chapters found or element not found');
                }
                console.log(chapters[0].chapterContent);
            })
            .catch(error => console.error('Error:', error));
    </script>
</body>
</html>